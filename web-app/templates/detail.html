<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ entry.title }} - Details</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="second-container">
    <h1>{{ entry.title }}</h1>

    <p><strong>Speaker:</strong> {{ entry.speaker }}</p>
    <p><strong>Date:</strong> {{ entry.date }}</p>
    <p><strong>Description:</strong> {{ entry.context }}</p>

    <p class="second-p"><strong>Transcript:</strong></p>
    <pre class="transcript-box">{{ entry.transcript }}</pre>

    <p><strong>Word Count:</strong> {{ entry.word_count }}</p>

    {% if entry.top_words %}
      <p><strong>Most Frequently Used 10 Words:</strong></p>
      <div style="max-width: 600px; height: 400px; margin: 0 auto;">
        <canvas id="topWordsChart"></canvas>
      </div>
    {% else %}
      <p><strong>Top Words:</strong> <em>No top words available.</em></p>
    {% endif %}

    {% if entry.audio_file %}
      <p style="margin-top: 2rem;"><strong>Audio:</strong></p>
      <audio controls style="width: 100%; margin-top: 1px;">
        <source src="{{ url_for('static', filename='uploaded_audio/' + entry.audio_file.split('/')[-1]) }}" type="audio/mpeg">
        Your browser does not support the audio tag.
      </audio>
    {% endif %}

    <a href="{{ url_for('edit_entry', file_path=entry._id) }}">✏️ Edit Entry</a>

    <div style="margin-top: 1.5rem;">
      <a href="{{ url_for('index') }}" class="cancel-button">← Back to List</a>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  {% if entry.top_words %}
  <script>
    const topWords = {{ entry.top_words[:10] | tojson }};
    const labels = topWords.map(pair => pair[0]);
    const counts = topWords.map(pair => pair[1]);

    const ctx = document.getElementById('topWordsChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Top Words',
          data: counts,
          backgroundColor: 'rgba(99, 102, 241, 0.7)', 
          borderColor: 'rgba(99, 102, 241, 1)',
          borderWidth: 1,
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            ticks: { color: '#333' }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#333',
              stepSize: 1,
              precision: 0
            }
          }
        }
      }
    });
  </script>
  {% endif %}
</body>
</html>